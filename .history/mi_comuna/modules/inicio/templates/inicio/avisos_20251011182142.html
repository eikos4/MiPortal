{% extends "base.html" %}

{% block content %}

<!-- HERO -->
<section class="relative h-[55vh] min-h-[380px] flex items-center justify-center bg-cover bg-center"
         style="background-image: url('{{ url_for('static', filename='img/digua.jpg') }}');">
  <div class="absolute inset-0 bg-gradient-to-t from-black/80 via-black/60 to-transparent"></div>
  <div class="relative z-10 text-center text-white max-w-3xl px-6">
    <h1 class="text-4xl md:text-5xl font-extrabold tracking-tight">
      🚨 Avisos Importantes
    </h1>
    <p class="mt-4 text-lg text-gray-200 leading-relaxed">
      Mantente informado sobre cortes de servicios, comunicados oficiales y alertas relevantes de 
      <span class="font-semibold text-yellow-300">{{ config.MUNICIPALITY_NAME or "tu comuna" }}</span>.
    </p>
    <div class="mt-6 flex flex-wrap justify-center gap-4">
      <a href="#listado-avisos"
         class="bg-yellow-400 hover:bg-yellow-300 text-gray-900 font-semibold px-6 py-3 rounded-lg shadow transition-transform hover:scale-105">
        📋 Ver Avisos
      </a>
      <a href="https://wa.me/56920576206?text=Hola%20quiero%20publicar%20un%20aviso"
         class="bg-red-600 hover:bg-red-700 text-white font-semibold px-6 py-3 rounded-lg shadow transition-transform hover:scale-105">
        ➕ Publicar Aviso
      </a>
    </div>
  </div>
</section>

<!-- LISTADO DE AVISOS -->
<section id="listado-avisos" class="max-w-7xl mx-auto px-6 py-16">
  <!-- Encabezado + Filtros -->
  <div class="flex flex-col md:flex-row md:items-end md:justify-between gap-4 mb-10">
    <div>
      <h2 class="text-3xl font-bold text-gray-900 flex items-center gap-2">
        📢 Comunicados Recientes
      </h2>
      <p class="text-gray-600 mt-1">Últimos avisos publicados para la comunidad.</p>
    </div>

    <!-- Filtros -->
    <form method="get" action="{{ url_for('inicio.avisos') }}" class="w-full md:w-auto bg-white border rounded-xl shadow-sm px-4 py-3">
      <div class="flex flex-wrap gap-3 items-center">
        <input name="q" value="{{ request.args.get('q','') }}" type="text"
               placeholder="🔍 Buscar aviso..."
               class="w-full sm:w-64 border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-red-600 transition">
        <input name="desde" value="{{ request.args.get('desde','') }}" type="date"
               class="border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-red-600 transition">
        <input name="hasta" value="{{ request.args.get('hasta','') }}" type="date"
               class="border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-red-600 transition">
        <label class="inline-flex items-center gap-2 text-sm text-gray-700">
          <input type="checkbox" name="vigentes" value="1" {% if request.args.get('vigentes') %}checked{% endif %}
                 class="rounded text-red-600 focus:ring-red-600">
          Solo vigentes
        </label>
        <button class="bg-red-600 hover:bg-red-700 text-white font-semibold rounded-lg px-4 py-2 transition">
          Filtrar
        </button>
      </div>
    </form>
  </div>

  <!-- Avisos -->
  {% if avisos and avisos|length %}
    <div class="space-y-5 animate-fadeIn">
      {% for a in avisos %}
      <article class="rounded-xl bg-red-50 border-l-4 border-red-600 p-5 shadow-sm hover:shadow-md hover:translate-x-1 transition-all duration-200">
        <div class="flex items-start gap-4">
          <div class="flex-shrink-0 w-10 h-10 flex items-center justify-center rounded-full bg-red-100 text-red-600 text-lg">
            ⚠️
          </div>
          <div>
            <p class="text-gray-900 font-semibold leading-snug">{{ a.mensaje }}</p>
            <p class="text-sm text-gray-700 mt-1">
              Vigente desde <strong>{{ a.fecha_inicio.strftime("%d/%m/%Y") }}</strong>
              {% if a.fecha_fin %} hasta <strong>{{ a.fecha_fin.strftime("%d/%m/%Y") }}</strong>{% endif %}
            </p>
          </div>
        </div>
      </article>
      {% endfor %}
    </div>
  {% else %}
    <!-- Empty state -->
    <div class="bg-gray-50 border rounded-xl p-10 text-center animate-fadeIn">
      <svg class="w-12 h-12 mx-auto text-gray-400 mb-3" viewBox="0 0 24 24" fill="none" stroke="currentColor">
        <path stroke-width="2" stroke-linecap="round" stroke-linejoin="round" d="M12 9v2m0 4h.01M21 12a9 9 0 
        11-18 0 9 9 0 0118 0z"/>
      </svg>
      <p class="text-gray-600">Sin avisos por ahora. ¡Buenas noticias! 😄</p>
      <a href="https://wa.me/56920576206?text=Hola%20quiero%20publicar%20un%20aviso"
         target="_blank"
         class="mt-4 inline-block bg-red-600 hover:bg-red-700 text-white font-semibold px-6 py-3 rounded-lg shadow transition">
        ➕ Publicar Aviso
      </a>
    </div>
  {% endif %}

  <!-- Paginación -->
  {% if pagination is defined %}
  <div class="mt-10 flex items-center justify-center gap-2">
    {% if pagination.has_prev %}
      <a href="{{ url_for('inicio.avisos', page=pagination.prev_num, **request.args.to_dict(flat=True)) }}"
         class="px-4 py-2 rounded-lg border hover:bg-gray-50 transition">⬅️ Anterior</a>
    {% endif %}
    <span class="px-4 py-2 text-sm text-gray-600">
      Página {{ pagination.page }} de {{ pagination.pages }}
    </span>
    {% if pagination.has_next %}
      <a href="{{ url_for('inicio.avisos', page=pagination.next_num, **request.args.to_dict(flat=True)) }}"
         class="px-4 py-2 rounded-lg border hover:bg-gray-50 transition">Siguiente ➡️</a>
    {% endif %}
  </div>
  {% endif %}
</section>

<!-- CTA FINAL -->
<section class="relative bg-gradient-to-r from-red-600 to-pink-700 py-16 text-white">
  <div class="relative mx-auto max-w-7xl px-6 flex flex-col md:flex-row items-center justify-between gap-8">
    <div class="max-w-xl text-center md:text-left">
      <h2 class="text-3xl font-extrabold">📢 ¿Tienes algo importante que comunicar?</h2>
      <p class="mt-2 text-red-100 text-lg leading-relaxed">
        Cambios de horario, cierres temporales, cortes de servicios o comunicados urgentes.  
        Publícalo en nuestro portal y llega a toda la comunidad en minutos.
      </p>
    </div>
    <div class="flex flex-col sm:flex-row gap-4">
      <a href="https://wa.me/56920576206?text=Hola%20quiero%20publicar%20un%20aviso"
         target="_blank"
         class="bg-yellow-400 hover:bg-yellow-300 text-gray-900 font-semibold px-6 py-3 rounded-lg shadow text-center transition">
        ➕ Publicar Aviso
      </a>
      <a href="https://wa.me/56920576206?text=Hola%20quiero%20más%20información%20sobre%20el%20portal"
         target="_blank"
         class="bg-white/10 border border-white/30 hover:bg-white/20 text-white font-semibold px-6 py-3 rounded-lg shadow text-center transition">
        ✉️ Contactar al equipo
      </a>
    </div>
  </div>
</section>

{% endblock %}
