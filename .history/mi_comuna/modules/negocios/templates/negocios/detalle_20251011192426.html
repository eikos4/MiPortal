{% extends "base.html" %}
{% block content %}

<!-- ====== HERO / COVER ====== -->
<section class="relative h-[48vh] min-h-[360px] w-full overflow-hidden">
  {% if negocio.imagen %}
    <img src="{{ url_for('static', filename=negocio.imagen) }}"
         alt="{{ negocio.nombre }}"
         class="absolute inset-0 h-full w-full object-cover">
  {% else %}
    <img src="{{ url_for('static', filename='img/default_business.png') }}"
         alt="Portada por defecto"
         class="absolute inset-0 h-full w-full object-cover opacity-90">
  {% endif %}

  <div class="absolute inset-0 bg-gradient-to-b from-black/70 via-black/60 to-black/80"></div>

  <div class="relative z-10 mx-auto flex h-full max-w-6xl items-end px-6 pb-8">
    <div class="flex items-end gap-4">
      <div class="shrink-0">
        {% if perfil and perfil.logo %}
          <img
            src="{{ url_for('static', filename=perfil.logo) }}"
            alt="Logo {{ negocio.nombre }}"
            class="h-20 w-20 rounded-full border-2 border-white shadow-lg object-cover"
          >
        {% else %}
          <div class="h-20 w-20 rounded-full border-2 border-white bg-white/20 text-white grid place-items-center text-xl font-bold shadow-lg">
            {{ (negocio.nombre or 'N')[:1] }}
          </div>
        {% endif %}
      </div>

      <div>
        <h1 class="text-3xl md:text-5xl font-extrabold text-white drop-shadow">
          {{ negocio.nombre }}
        </h1>
        <p class="mt-1">
          <span class="inline-flex items-center gap-2 text-white/90 text-sm">
            <span class="px-2 py-0.5 rounded-full bg-white/10 border border-white/20 backdrop-blur">
              {{ negocio.categoria.nombre if negocio.categoria else "Sin categoría" }}
            </span>
          </span>
        </p>
      </div>
    </div>
  </div>
</section>

<!-- ====== BODY ====== -->
<section class="mx-auto grid max-w-6xl grid-cols-1 gap-8 px-6 py-10 md:grid-cols-3">

  <!-- ====== LEFT / FEED & ABOUT ====== -->
  <div class="md:col-span-2 space-y-8">

    <!-- Sobre el negocio -->
    <article class="rounded-2xl bg-white p-6 shadow">
      <h2 class="mb-3 text-xl font-bold text-gray-900">ℹ️ Sobre el negocio</h2>
      <p class="text-gray-700 leading-relaxed">
        {{ negocio.descripcion or "Este negocio aún no ha agregado una descripción." }}
      </p>

      <dl class="mt-4 grid gap-3 text-sm text-gray-700">
        {% if negocio.direccion %}
          <div class="flex items-start gap-2">
            <span>📍</span>
            <dd>{{ negocio.direccion }}</dd>
          </div>
        {% endif %}
        {% if negocio.horario %}
          <div class="flex items-start gap-2">
            <span>🕑</span>
            <dd>{{ negocio.horario }}</dd>
          </div>
        {% endif %}
      </dl>
    </article>

    <!-- Publicaciones -->
    <section class="space-y-4">
      <div class="flex items-center justify-between">
        <h2 class="text-lg font-bold text-gray-900">📰 Actividad reciente</h2>
        {% if feed and feed|length %}
          <span class="text-xs text-gray-500">Total: {{ feed|length }}</span>
        {% endif %}
      </div>

      {% if feed and feed|length %}
        <div class="space-y-6">
          {% for pub in feed %}
            <article
              class="rounded-2xl border-l-4 bg-white p-6 shadow transition hover:shadow-lg
                     {% if pub.tipo == 'aviso' %}border-yellow-400
                     {% elif pub.tipo == 'evento' %}border-blue-400
                     {% elif pub.tipo == 'noticia' %}border-gray-400
                     {% elif pub.tipo == 'oferta' %}border-green-400{% endif %}"
            >
              <header class="mb-3 flex items-center justify-between gap-3">
                <div class="flex items-center gap-2">
                  <span class="rounded-full px-2 py-0.5 text-xs font-semibold
                    {% if pub.tipo == 'aviso' %}bg-yellow-100 text-yellow-800
                    {% elif pub.tipo == 'evento' %}bg-blue-100 text-blue-800
                    {% elif pub.tipo == 'noticia' %}bg-gray-100 text-gray-800
                    {% elif pub.tipo == 'oferta' %}bg-green-100 text-green-800{% endif %}">
                    {% if pub.tipo == 'aviso' %}📢 Aviso
                    {% elif pub.tipo == 'evento' %}🎉 Evento
                    {% elif pub.tipo == 'noticia' %}📰 Noticia
                    {% elif pub.tipo == 'oferta' %}💸 Oferta{% endif %}
                  </span>
                  <h3 class="text-base font-bold text-gray-900">{{ pub.titulo }}</h3>
                </div>

                <p class="shrink-0 text-xs text-gray-500">
                  {% if pub.fecha %}{{ pub.fecha.strftime('%d/%m/%Y') }}{% endif %}
                </p>
              </header>

              {% set img_src = pub.imagen if pub.imagen else 'img/default_business.png' %}
              {% if img_src %}
                <img
                  src="{{ url_for('static', filename=img_src) }}"
                  alt="{{ pub.titulo }}"
                  class="mb-4 h-48 w-full rounded-lg object-cover"
                >
              {% endif %}

              <p class="text-sm leading-relaxed text-gray-700">
                {% if pub.tipo == 'noticia' %}
                  {{ (pub.descripcion or '')[:280] }}{% if pub.descripcion and pub.descripcion|length > 280 %}…{% endif %}
                {% else %}
                  {{ pub.descripcion or '' }}
                {% endif %}
              </p>

              {% if pub.tipo == 'evento' and pub.extra %}
                <p class="mt-3 text-xs text-gray-600">
                  {% if pub.extra.fecha %}📅 {{ pub.extra.fecha.strftime('%d/%m/%Y') }}{% endif %}
                  {% if pub.extra.lugar %} · 📍 {{ pub.extra.lugar }}{% endif %}
                </p>
              {% endif %}

              {% if pub.tipo == 'aviso' and pub.extra %}
                <p class="mt-3 text-xs text-gray-600">
                  {% if pub.extra.inicio %}📅 Desde {{ pub.extra.inicio.strftime('%d/%m/%Y') }}{% endif %}
                  {% if pub.extra.fin %} hasta {{ pub.extra.fin.strftime('%d/%m/%Y') }}{% endif %}
                </p>
              {% endif %}

              {% if pub.tipo == 'oferta' and pub.extra %}
                <div class="mt-3 text-xs text-gray-600">
                  {% if pub.extra.inicio %}
                    📅 Desde {{ pub.extra.inicio.strftime('%d/%m/%Y') }}
                    {% if pub.extra.fin %} hasta {{ pub.extra.fin.strftime('%d/%m/%Y') }}{% endif %}
                  {% endif %}
                  {% if pub.extra.vigente is not none %}
                    {% if pub.extra.vigente %}
                      <span class="ml-2 rounded-full bg-green-100 px-2 py-0.5 font-semibold text-green-700">✅ Vigente</span>
                    {% else %}
                      <span class="ml-2 rounded-full bg-red-100 px-2 py-0.5 font-semibold text-red-700">⏰ Expirada</span>
                    {% endif %}
                  {% endif %}
                </div>
              {% endif %}
            </article>
          {% endfor %}
        </div>
      {% else %}
        <div class="rounded-2xl border border-dashed p-10 text-center text-gray-500">
          ⚠️ Este negocio aún no tiene publicaciones.
        </div>
      {% endif %}
    </section>
  </div>

  <!-- ====== RIGHT / SIDEBAR ====== -->
  <aside class="space-y-6">

    <!-- Contacto -->
    <div class="rounded-2xl bg-white p-6 shadow">
      <h3 class="mb-3 text-lg font-bold text-gray-900">📞 Contacto</h3>
      <ul class="space-y-2 text-sm text-gray-700">
        {% if negocio.telefono %}
          <li>📞 <a class="text-blue-600 hover:underline" href="tel:{{ negocio.telefono }}">{{ negocio.telefono }}</a></li>
        {% endif %}
        {% if negocio.whatsapp %}
          <li>💬 <a class="text-green-600 hover:underline" href="https://wa.me/{{ negocio.whatsapp }}" target="_blank" rel="noopener">WhatsApp</a></li>
        {% endif %}
        {% if negocio.email %}
          <li>📧 <a class="text-purple-600 hover:underline" href="mailto:{{ negocio.email }}">Email</a></li>
        {% endif %}
        {% if negocio.sitio_web %}
          <li>🌐 <a class="text-indigo-600 hover:underline" href="{{ negocio.sitio_web }}" target="_blank" rel="noopener">Sitio Web</a></li>
        {% endif %}
      </ul>
    </div>

    <!-- Redes -->
    <div class="rounded-2xl bg-white p-6 shadow">
      <h3 class="mb-3 text-lg font-bold text-gray-900">🌍 Redes sociales</h3>
      <ul class="space-y-2 text-sm">
        {% if negocio.facebook %}
          <li>📘 <a href="{{ negocio.facebook }}" class="text-blue-700 hover:underline" target="_blank" rel="noopener">Facebook</a></li>
        {% endif %}
        {% if negocio.instagram %}
          <li>📸 <a href="{{ negocio.instagram }}" class="text-pink-600 hover:underline" target="_blank" rel="noopener">Instagram</a></li>
        {% endif %}
        {% if negocio.tiktok %}
          <li>🎶 <a href="{{ negocio.tiktok }}" class="hover:underline" target="_blank" rel="noopener">TikTok</a></li>
        {% endif %}
        {% if not (negocio.facebook or negocio.instagram or negocio.tiktok) %}
          <li class="text-gray-500">Sin redes registradas.</li>
        {% endif %}
      </ul>
    </div>

    <!-- Categoría -->
    <div class="rounded-2xl bg-white p-6 text-center shadow">
      <span class="rounded-full bg-blue-50 px-3 py-1 text-sm font-semibold text-blue-700">
        {{ negocio.categoria.nombre if negocio.categoria else "Sin categoría" }}
      </span>
    </div>

  </aside>
</section>

{% endblock %}
