{% extends "admin/base_admin.html" %}

{% block header %}📢 Avisos{% endblock %}

{% block content %}
<div class="max-w-7xl mx-auto bg-white p-8 rounded-2xl shadow mt-10">

  <!-- 🔹 Encabezado -->
  <div class="flex justify-between items-center mb-8 border-b border-gray-200 pb-4">
    <div>
      <h1 class="text-3xl font-extrabold text-gray-800 flex items-center gap-2">
        📢 Gestión de Avisos
      </h1>
      <p class="text-gray-500 text-sm mt-1">Administra los avisos activos y programa nuevas publicaciones</p>
    </div>
    <a href="{{ url_for('admin.crear_aviso') }}"
       class="bg-blue-600 text-white px-5 py-2.5 rounded-lg font-semibold shadow hover:bg-blue-700 transition">
      ➕ Nuevo Aviso
    </a>
  </div>

  <!-- 🔹 Mensajes Flash -->
  {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
      {% for category, message in messages %}
        <div class="mb-5 px-4 py-3 rounded-lg text-sm font-medium
                    {% if category == 'success' %} bg-green-100 text-green-800 border border-green-300
                    {% elif category == 'warning' %} bg-yellow-100 text-yellow-800 border border-yellow-300
                    {% elif category == 'danger' %} bg-red-100 text-red-800 border border-red-300
                    {% else %} bg-blue-100 text-blue-800 border border-blue-300 {% endif %}">
          {{ message }}
        </div>
      {% endfor %}
    {% endif %}
  {% endwith %}

  <!-- 🔹 Tabla de avisos -->
  {% if avisos %}
    <div class="overflow-x-auto rounded-xl border border-gray-200">
      <table class="min-w-full text-sm text-left">
        <thead class="bg-gray-100 text-gray-700 uppercase text-xs font-semibold">
          <tr>
            <th class="px-6 py-3">🖼 Imagen</th>
            <th class="px-6 py-3">📢 Mensaje</th>
            <th class="px-6 py-3">📅 Inicio</th>
            <th class="px-6 py-3">⏳ Fin</th>
            <th class="px-6 py-3 text-right">⚙️ Acciones</th>
          </tr>
        </thead>
        <tbody class="divide-y divide-gray-100">
          {% for aviso in avisos %}
          <tr class="hover:bg-gray-50 transition">
            <!-- Imagen -->
            <td class="px-6 py-4">
              {% if aviso.imagen %}
                <img src="{{ url_for('static', filename=aviso.imagen) }}"
                     alt="Imagen aviso"
                     class="h-14 w-14 object-cover rounded-lg shadow border border-gray-200">
              {% else %}
                <span class="text-gray-400 italic text-xs">Sin imagen</span>
              {% endif %}
            </td>

            <!-- Mensaje -->
            <td class="px-6 py-4 text-gray-800">
              {{ aviso.mensaje[:80] }}{% if aviso.mensaje|length > 80 %}...{% endif %}
            </td>

            <!-- Fecha de inicio -->
            <td class="px-6 py-4 text-gray-700">
              {{ aviso.fecha_inicio.strftime("%d/%m/%Y") }}
            </td>

            <!-- Fecha de fin -->
            <td class="px-6 py-4 text-gray-700">
              {% if aviso.fecha_fin %}
                {{ aviso.fecha_fin.strftime("%d/%m/%Y") }}
              {% else %}
                <span class="text-gray-400 italic text-xs">Indefinido</span>
              {% endif %}
            </td>

            <!-- Acciones -->
            <td class="px-6 py-4 text-right">
              <form action="{{ url_for('admin.eliminar_aviso', id=aviso.id) }}"
                    method="POST"
                    onsubmit="return confirm('⚠️ ¿Seguro que quieres eliminar este aviso? Esta acción no se puede deshacer.');"
                    class="inline-block">
                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                <button type="submit"
                        class="text-red-600 hover:text-red-800 font-semibold text-sm transition">
                  🗑 Eliminar
                </button>
              </form>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  {% else %}
    <!-- Estado vacío -->
    <div class="flex flex-col items-center justify-center py-16 text-center text-gray-500">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-16 w-16 text-gray-400 mb-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
              d="M9 17v-6h13M9 5v.01M21 21H3V3h18v18z" />
      </svg>
      <p class="text-lg font-semibold">No hay avisos registrados.</p>
      <p class="text-sm text-gray-400 mt-1">Crea un nuevo aviso para informar a la comunidad.</p>
      <a href="{{ url_for('admin.crear_aviso') }}"
         class="mt-5 inline-block bg-blue-600 text-white px-5 py-2 rounded-lg shadow hover:bg-blue-700 transition">
        ➕ Crear el primer aviso
      </a>
    </div>
  {% endif %}
</div>
{% endblock %}
